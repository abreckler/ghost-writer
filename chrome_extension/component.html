<html>
<head>
  <link rel="stylesheet" type="text/css" href="src/css/content_script.css" >
  <link rel="stylesheet" type="text/css" href="src/css/three-dots.min.css" >
</head>
<body style="padding: 300px 400px;">

<div class="gwf gwf-view-panel" style="position:absolute;z-index:100000">

  <div class="gwf-btn">
    <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 92 92" enable-background="new 0 0 92 92" xml:space="preserve" class="arrow-icon show">
    <path id="XMLID_507_" d="M49.9,88c-0.2,0-0.4,0-0.6-0.1c-1.8-0.3-3.2-1.7-3.3-3.5l-3.5-34.8L7.6,46.1c-1.8-0.2-3.3-1.6-3.5-3.3c-0.3-1.8,0.7-3.5,2.3-4.3l76-34.1c1.5-0.7,3.3-0.4,4.5,0.8c1.2,1.2,1.5,3,0.8,4.5l-34.1,76C52.9,87.1,51.4,88,49.9,88z M23.3,39.7L46.4,42c1.9,0.2,3.4,1.7,3.6,3.6l2.4,23.1L76,16L23.3,39.7z"></path>
    </svg>
    <div class="dot-loading dot-pulse"></div>
  </div>

  <div class="gwf-panel">
    <div class="gwf-panel-header">
    Ghost writer suggests:
    </div>
    <div class="gwf-panel-body">
      <ul class="gwf-candidates">
        <li class="gwf-answer"><p>This is the first line</p></li>
        <li class="gwf-answer"><p>This is the second line.</br>This is the second line</p></li>
        <li class="gwf-answer"><p>This is the third line.</br>This is the third line.</br>This is the third line</p></li>
      </ul>
    </div>
  </div>
</div>

<script>
  var ghostFace = document.querySelector('.gwf');

  function whisper(text, pos) {
    var el = document.createElement('span');
    el.innerText = text;
    el.style.position = 'fixed';
    el.style.opacity = 1;
    el.style.zIndex = 1000;
    ghostFace.appendChild(el);
    var rect = el.getBoundingClientRect();
    el.style.left = (pos.x - rect.width / 2) + 'px';
    el.style.top = (pos.y - rect.height - window.scrollY) + 'px';

    // animate
    el.classList.add('gwf-whisper');
    setTimeout(() => el.remove(), 500);
    setTimeout(() => {
      el.style.top = (pos.y - 4 * rect.height - window.scrollY) + 'px';
      el.style.opacity = 0;
    }, 0);
  }

  function copyTextToClipboard(text) {
		var textArea = document.createElement("textarea");

		textArea.style.position = 'fixed';
		textArea.style.top = 0;
		textArea.style.left = 0;
    textArea.style.padding = 0;
    textArea.style.border = 'none';
		textArea.style.outline = 'none';
		textArea.style.boxShadow = 'none';

		// Ensure it has a small width and height. Setting to 1px / 1em
		// doesn't work as this gives a negative w/h on some browsers.
		textArea.style.width = '2em';
		textArea.style.height = '2em';

		// Avoid flash of white box if rendered for any reason.
		textArea.style.background = 'transparent';

		textArea.value = text;

		document.body.appendChild(textArea);

		textArea.select();

    var copied = false;
		try {
			document.execCommand('copy');
      success = true;
		} catch (err) {
		} finally {
			document.body.removeChild(textArea);
		}
    return copied;
	}

  function answerClicked(answerEl, evt) {
    copyTextToClipboard(answerEl.innerText);
    whisper('Copied into the clipboard!', {x: evt.pageX, y: evt.pageY});
  }

  ghostFace.addEventListener('click', (event) => {
    event.stopPropagation();
    var target = event.target;
    while(target) {
      if (target.matches('.gwf-answer')) {
        if (event.pageX == null && event.clientX != null) {
          eventDoc = (event.target && event.target.ownerDocument) || document;
          doc = eventDoc.documentElement;
          body = eventDoc.body;

          event.pageX = event.clientX +
            (doc && doc.scrollLeft || body && body.scrollLeft || 0) -
            (doc && doc.clientLeft || body && body.clientLeft || 0);
          event.pageY = event.clientY +
            (doc && doc.scrollTop  || body && body.scrollTop  || 0) -
            (doc && doc.clientTop  || body && body.clientTop  || 0 );
        }
        answerClicked(target, event);
      }
      target = target.parentElement;
    }
  });
</script>

</body>
</html>